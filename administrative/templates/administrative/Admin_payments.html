{% extends "base.html" %}
{% load static %}
{% block title %}MTA - Pagos{% endblock %}

{% block nav_title %}Pagos{% endblock %}
{% block nav_tabs %}
<!-- Should be doing this based on the current logged user -->
<li class="bold waves-effect"><a class="collapsible-header">Pages<i class="material-icons chevron">chevron_left</i></a>
  <div class="collapsible-body">
    <ul>
      <li><a href="dashboard.html" class="waves-effect">Dashboard<i class="material-icons">web</i></a></li>
      <li><a href="pages-fixed-chart.html" class="waves-effect">Fixed Chart<i class="material-icons">list</i></a></li>
      <li><a href="pages-grid.html" class="waves-effect">Grid<i class="material-icons">dashboard</i></a></li>
      <li><a href="pages-chat.html" class="waves-effect">Chat<i class="material-icons">chat</i></a></li>
    </ul>
  </div>
</li>
<li class="bold waves-effect"><a class="collapsible-header">Charts<i class="material-icons chevron">chevron_left</i></a>
  <div class="collapsible-body">
    <ul>
      <li><a href="line-charts.html" class="waves-effect">Line Charts<i class="material-icons">show_chart</i></a></li>
      <li><a href="bar-charts.html" class="waves-effect">Bar Charts<i class="material-icons">equalizer</i></a></li>
      <li><a href="area-charts.html" class="waves-effect">Area Charts<i class="material-icons">multiline_chart</i></a></li>
      <li><a href="doughnut-charts.html" class="waves-effect">Doughnut Charts<i class="material-icons">pie_chart</i></a></li>
      <li><a href="financial-charts.html" class="waves-effect">Financial Charts<i class="material-icons">euro_symbol</i></a></li>
      <li><a href="interactive-charts.html" class="waves-effect">Interactive Charts<i class="material-icons">touch_app</i></a></li>
    </ul>
  </div>
</li>
<li class="bold waves-effect"><a class="collapsible-header">Tables<i class="material-icons chevron">chevron_left</i></a>
  <div class="collapsible-body">
    <ul>
      <li><a href="fullscreen-table.html" class="waves-effect">Fullscreen with Chart<i class="material-icons">show_chart</i></a></li>
      <li><a href="table-custom-elements.html" class="waves-effect">Table with Custom Elements<i class="material-icons">settings</i></a></li>
    </ul>
  </div>
</li>
<li class="bold waves-effect"><a class="collapsible-header">Calendar<i class="material-icons chevron">chevron_left</i></a>
  <div class="collapsible-body">
    <ul>
      <li><a href="calendar.html" class="waves-effect">Calendar<i class="material-icons">cloud</i></a></li>
    </ul>
  </div>
</li>
<li class="bold waves-effect"><a class="collapsible-header">Headers<i class="material-icons chevron">chevron_left</i></a>
  <div class="collapsible-body">
    <ul>
      <li><a href="header-tabbed.html" class="waves-effect">Tabbed<i class="material-icons">tab</i></a></li>
      <li><a href="header-metrics.html" class="waves-effect">Metrics<i class="material-icons">web</i></a></li>
      <li><a href="header-search.html" class="waves-effect">Search<i class="material-icons">search</i></a></li>
    </ul>
  </div>
</li>
<li class="bold waves-effect"><a class="collapsible-header">Account<i class="material-icons chevron">chevron_left</i></a>
  <div class="collapsible-body">
    <ul>
      <li><a href="log-in.html" class="waves-effect">Log In<i class="material-icons">person</i></a></li>
      <li><a href="settings.html" class="waves-effect">Settings<i class="material-icons">settings</i></a></li>
    </ul>
  </div>
</li>
{% endblock nav_tabs %}

{% block content %}
<main>
  <div class="container">
    <div class="card">
      <div class="card-content">
        <div class="row">
          <div class="col s12">
            <ul class="tabs ">
              <li class="tab col s3"><a class="active" href="#unresolved">Por Pagar</a></li>
              <li class="tab col s3"><a href="#resolved">Pagados</a></li>
            </ul>

          </div>
          <div id="unresolved" class="col s12">
            <table class="striped highlight">
              <thead>
                <tr>
                  <th>Promotora</th>
                  <th>Descripcion</th>
                  <th>Cantidad</th>
                  <th>Pagar antes de</th>
                  <th>Marcar como pagado</th>
                </tr>
              </thead>
              <tbody>
                {% for payment in upcoming_payments %}
                  <tr>
                    <td>
                      {{payment.promoter}}
                    </td>
                    <td>
                      {{payment.description}}
                    </td>
                    <td>
                      {{payment.quantity}}
                    </td>
                    {% if payment.due_date > curdate %}
                    <td>
                      {{payment.due_date|date:"d / m / Y"}}
                    </td>
                    {% else %}
                    <td class="red-text">
                      {{payment.due_date|date:"d / m / Y"}}
                    </td>
                    {% endif %}
                    <td>
                      <a class="modal-trigger " onclick="ajaxCall({{payment.id}})">
                        <i class="material-icons">check_circle_outline</i>
                      </a>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td>No hay pagos pendientes.</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="resolved" class="col s12">
            <table class="striped highlight">
              <thead>
                <tr>
                  <tr>
                    <th>Promotora</th>
                    <th>Descripcion</th>
                    <th>Cantidad</th>
                    <th>Comentarios</th>
                    <th>Fecha de pago</th>
                  </tr>
                </tr>
              </thead>
              <tbody>
                {% for payment in past_payments %}
                  <tr>
                    <td>
                      {{payment.promoter}}
                    </td>
                    <td>
                      {{payment.description}}
                    </td>
                    <td>
                      {{payment.quantity}}
                    </td>
                    <td>
                      {{payment.comment}}
                    </td>
                    <td>
                      {{payment.pay_date|date:"d / m / Y"}}
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td>No hay pagos realizados</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="fixed-action-btn">
    <a class="btn-floating btn-large red modal-trigger"  href="#new_payment">
      <i class="large material-icons">add</i>
    </a>
  </div>
</main>
<div id="pay-modal" class="modal">
  <div class="modal-content">
    <h4>Pagar</h4>
    <div class="row">
      <div class="col s12"><b>Promotora:  </b><span id="promoter-name">loremipsum</span></div>
    </div>
    <div class="row">
      <div class="col s12"><b>Descripción:  </b><span id="description-text">loremipsum</span></div>
    </div>
    <div class="row">
      <div class="col s12"><b>Cantidad:  </b><span id="quantity-text">loremipsum</span></div>
    </div>
    <form id="pay-form" method="post" action="/administrative/pay/">
      {% csrf_token %}
      <div class="input-field">
        <input id="{{form.comment.id_for_label}}" name="{{form.comment.html_name}}" type="text" class="validate" required>
        <label for="{{form.comment.id_for_label}}">No. Folio, Comentarios, etc.</label>
      </div>
      <button class="btn waves-effect waves-light right" type="submit"value="Submit" name="action">Enviar
        <i class="material-icons right">send</i>
      </button><br>
    </form>
    <br>
  </div>
</div>
<div id="new_payment" class="modal">
  <div class="modal-content">
    <h4>Nuevo pago</h4>
    <form action="/administrative/add_payment/" method="POST">
      {% csrf_token %}
      <div class="row">
        <div class="input-field col s4 m4">
          <label for="{{new_payment.promoter.id_for_label}}" class="active">Promotora</label>
          <select id="{{new_payment.promoter.id_for_label}}" name="{{new_payment.promoter.html_name}}" required>
            <option value="" disabled selected>Selecciona uno</option>
            {% for choice in new_payment.promoter.field.queryset %}
              <option value="{{choice.id}}">{{choice}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="input-field col s4 m4">
          <label class="active" for="{{new_payment.quantity.id_for_label}}">Cantidad</label>
          <input required id="{{new_payment.quantity.id_for_label}}" name="{{new_payment.quantity.html_name}}" type="number" class="validate">
        </div>
        <div class="input-field col s4 m4">
          <label for="{{new_payment.due_date.id_for_label}}" class="active">Pagar antes de</label>
          <input required id="{{new_payment.due_date.id_for_label}}" name="{{new_payment.due_date.html_name}}" type="date" class="validate">
        </div>
        <div class="input-field col s12 m12">
          <label for="{{new_payment.description.id_for_label}}" class="active">Descripcion</label>
          <input required id="{{new_payment.description.id_for_label}}" name="{{new_payment.description.html_name}}" type="text" class="validate" maxlength="100">
        </div>

        <button class="btn waves-effect waves-light right" type="submit"value="Submit" name="action">Enviar
          <i class="material-icons right">send</i>
        </button>
      </div>

      <br><br>
    </form>
  </div>
</div>
{% endblock content %}
{% block init_scripts %}
{% endblock init_scripts %}
{% block js %}
<script type="text/javascript">
  $(document).ready(function(){
    //Inicializar componentes
    $('.tabs').tabs(
      swipeable=true
    );
    /*$('.datepicker').pickadate({
      alert("Juan");

    		months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
    		monthsShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
    		weekdaysFull: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
    		weekdaysShort: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
        weekdaysAbbrev: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],
        format: 'dd/mm/yyyy'
    });*/
  });
  function ajaxCall(id){
    path = "/administrative/get_payment/" + id;
    $.ajax({
      method: "GET",
      url: path
    }).done(function(data) {
      console.log(data['promoter']);
      $("#promoter-name").text(data['promoter']);
      $("#description-text").text(data['description']);
      $("#quantity-text").text("$" + data['quantity']);
      $("#pay-form").attr("action", '/administrative/pay/'+data['pk']+'/');
      $('#pay-modal').modal('open');
    });
  }

</script>
{% endblock js %}
